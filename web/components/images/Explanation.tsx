export default function Explanation({ step = 5 }: { step?: number }) {
    const hiddenIdentity = step < 2;
    const nodeWorking = step < 4;
    const mailCoords = [
        [[38, 38]],
        [[274, 34]],
        [[424, 34]],
        [[318, 152], [388, 152], [282, 212], [353, 212], [424, 212], [318, 272], [388, 272]],
        [[318, 152], [388, 152], [282, 212], [353, 212], [424, 212], [318, 272], [388, 272]],
        [[38, 238]],
    ]

    function coord(i: number) {
        return mailCoords[step][i] ?? mailCoords[step].at(-1)!;
    }

    return (
    <svg viewBox="0 0 489 324" className="flex-1 min-h-50 max-h-100" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M108.643 0H8.35714C3.73982 0 0 3.73333 0 8.33333V91.6667C0 96.2667 3.73982 100 8.35714 100H108.643C113.256 100 117 96.2667 117 91.6667V8.33333C117 3.73333 113.256 0 108.643 0ZM39.9555 6.25C42.2621 6.25 44.1299 8.11667 44.1299 10.4167C44.1299 12.7167 42.2621 14.5833 39.9555 14.5833C37.6447 14.5833 35.7769 12.7167 35.7769 10.4167C35.7769 8.11667 37.6489 6.25 39.9555 6.25ZM27.1607 6.25C29.4673 6.25 31.3393 8.11667 31.3393 10.4167C31.3393 12.7167 29.4673 14.5833 27.1607 14.5833C24.85 14.5833 22.9821 12.7167 22.9821 10.4167C22.9821 8.11667 24.85 6.25 27.1607 6.25ZM14.6208 6.25C16.9316 6.25 18.7994 8.11667 18.7994 10.4167C18.7994 12.7167 16.9316 14.5833 14.6208 14.5833C12.3142 14.5833 10.4464 12.7167 10.4464 10.4167C10.4464 8.11667 12.3142 6.25 14.6208 6.25ZM108.643 91.6667H8.35714V20.9208H108.643V91.6667ZM108.643 12.5875H50.1429V8.42083H108.643V12.5875Z" fill="#FFC400"/>
        <path transform="translate(0,200)" d="M108.643 0H8.35714C3.73982 0 0 3.73333 0 8.33333V91.6667C0 96.2667 3.73982 100 8.35714 100H108.643C113.256 100 117 96.2667 117 91.6667V8.33333C117 3.73333 113.256 0 108.643 0ZM39.9555 6.25C42.2621 6.25 44.1299 8.11667 44.1299 10.4167C44.1299 12.7167 42.2621 14.5833 39.9555 14.5833C37.6447 14.5833 35.7769 12.7167 35.7769 10.4167C35.7769 8.11667 37.6489 6.25 39.9555 6.25ZM27.1607 6.25C29.4673 6.25 31.3393 8.11667 31.3393 10.4167C31.3393 12.7167 29.4673 14.5833 27.1607 14.5833C24.85 14.5833 22.9821 12.7167 22.9821 10.4167C22.9821 8.11667 24.85 6.25 27.1607 6.25ZM14.6208 6.25C16.9316 6.25 18.7994 8.11667 18.7994 10.4167C18.7994 12.7167 16.9316 14.5833 14.6208 14.5833C12.3142 14.5833 10.4464 12.7167 10.4464 10.4167C10.4464 8.11667 12.3142 6.25 14.6208 6.25ZM108.643 91.6667H8.35714V20.9208H108.643V91.6667ZM108.643 12.5875H50.1429V8.42083H108.643V12.5875Z" fill="#FF3C00"/>
        
        <path transform="translate(250,0)" d="M44 0L88 25V75L44 100L0 75V25L44 0Z" fill="#00BFAF"/>
        <path transform="translate(400,0)" d="M44 0L88 25V75L44 100L0 75V25L44 0Z" fill="#00BFAF"/>
        
        <g transform="translate(272,135)">
            <path d="M136.208 120.508L165.992 137.527V171.566L136.208 188.586L106.424 171.566V137.527L136.208 120.508Z" fill={nodeWorking ? "#00BFAF" : "#7E8685"}/>
            <path d="M136.208 0L165.992 17.0195V51.0584L136.208 68.0778L106.424 51.0584V17.0195L136.208 0Z" fill="#00BFAF"/>
            <path d="M66.307 120.508L96.0911 137.527V171.566L66.307 188.586L36.5229 171.566V137.527L66.307 120.508Z" fill="#00BFAF"/>
            <path d="M100.848 60.7578L130.632 77.7773V111.816L100.848 128.836L71.064 111.816V77.7773L100.848 60.7578Z" fill="#00BFAF"/>
            <path d="M66.307 0L96.0911 17.0195V51.0584L66.307 68.0778L36.5229 51.0584V17.0195L66.307 0Z" fill="#00BFAF"/>
            <path d="M29.7841 60.7578L59.5681 77.7773V111.816L29.7841 128.836L0 111.816V77.7773L29.7841 60.7578Z" fill="#00BFAF"/>
            <path d="M171.912 60.7578L201.697 77.7773V111.816L171.912 128.836L142.128 111.816V77.7773L171.912 60.7578Z" fill="#00BFAF"/>
        </g>
        {Array.from({ length: 7 }).map((_, i) => (
            <g className="transition-all duration-300" key={i} style={{ transform: `translate(${coord(i)[0]}px,${coord(i)[1]}px)` }}>
                <circle cx="20.5" cy="17" r="26" stroke="#727272" strokeWidth="3" style={{ visibility: hiddenIdentity ? 'initial' : 'hidden', opacity: hiddenIdentity ? 100 : 0 }} className="transition-all duration-300"/>
                <path d="M32.5171 30.9903H8.48348C6.16277 30.9903 5.00242 30.9903 4.11603 30.5385C3.33633 30.1413 2.70242 29.5071 2.30516 28.7273C1.85352 27.8407 1.85352 26.6799 1.85352 24.3586V8.60828C1.85352 6.28695 1.85352 5.1263 2.30516 4.23968C2.70242 3.45977 3.33633 2.82569 4.11603 2.42833C5.00242 1.97656 6.16279 1.97656 8.48348 1.97656H32.5171C34.8378 1.97656 35.9983 1.97656 36.8846 2.42833C37.6643 2.82569 38.2983 3.45977 38.6954 4.23968C39.1471 5.1263 39.1471 6.28697 39.1471 8.60828V24.3586C39.1471 26.6799 39.1471 27.8407 38.6954 28.7273C38.2983 29.5071 37.6643 30.1413 36.8846 30.5385C35.9983 30.9903 34.8378 30.9903 32.5171 30.9903Z" fill="#FFC400"/>
                <path d="M39.1471 8.1938L31.7696 12.2935C27.6565 14.5791 25.6 15.722 23.4221 16.1701C21.4944 16.5665 19.5062 16.5665 17.5786 16.1701C15.4007 15.722 13.3441 14.5791 9.23101 12.2935L1.85352 8.1938M8.48348 30.9903H32.5171C34.8378 30.9903 35.9983 30.9903 36.8846 30.5385C37.6643 30.1413 38.2983 29.5071 38.6954 28.7273C39.1471 27.8407 39.1471 26.6799 39.1471 24.3586V8.60828C39.1471 6.28697 39.1471 5.1263 38.6954 4.23968C38.2983 3.45977 37.6643 2.82569 36.8846 2.42833C35.9983 1.97656 34.8378 1.97656 32.5171 1.97656H8.48348C6.16279 1.97656 5.00242 1.97656 4.11603 2.42833C3.33633 2.82569 2.70242 3.45977 2.30516 4.23968C1.85352 5.1263 1.85352 6.28695 1.85352 8.60828V24.3586C1.85352 26.6799 1.85352 27.8407 2.30516 28.7273C2.70242 29.5071 3.33633 30.1413 4.11603 30.5385C5.00242 30.9903 6.16277 30.9903 8.48348 30.9903Z" stroke="black" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"/>
            </g>
        ))}
    </svg>
    );
}